import{h,r as _,j as s,i as f,w as x,x as k,R as u,A as v,y as w}from"./index-av8iVJeD.js";import{B as b,T as m,E as j}from"./errors-3bkEACvd.js";import{u as y}from"./index.esm-Blx1mMy4.js";class c extends Error{}c.prototype.name="InvalidTokenError";function E(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function S(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return E(e)}catch{return atob(e)}}function T(o,e){if(typeof o!="string")throw new c("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,r=o.split(".")[t];if(typeof r!="string")throw new c(`Invalid token specified: missing part #${t+1}`);let a;try{a=S(r)}catch(l){throw new c(`Invalid token specified: invalid base64 for part #${t+1} (${l.message})`)}try{return JSON.parse(a)}catch(l){throw new c(`Invalid token specified: invalid json for part #${t+1} (${l.message})`)}}const I=()=>{const{register:o,handleSubmit:e,formState:{errors:t}}=y(),r=h(),[a,l]=_.useState(""),p=d=>{console.log("form data",d),x(d).then(n=>{console.log("Token:",n.token);const i=T(n.token);console.log("Decoded Token",i),i.token=n.token,k(i),r(u.main)}).catch(n=>{if(n instanceof v){const i=j[n.messageFromServer];i&&l(i),console.log(n.messageFromServer),console.log(n.time),console.log(n.status)}else console.log(n)})};return s.jsxs(b,{component:"form",onSubmit:e(p),sx:{display:"flex",flexDirection:"column",gap:2,width:400,mx:"auto",mt:4},children:[s.jsx(m,{required:!0,error:!!t.login,helperText:t.login?.message,...o("login",{required:"Введите логин",minLength:{value:6,message:"Минимум 6 символов"},pattern:{value:/^[A-Za-z0-9]+$/,message:"Только латинские буквы и цифры"}}),label:"Логин",variant:"outlined"}),s.jsx(m,{required:!0,error:!!t.password,helperText:t.password&&"Пароль должен быть длиннее 8 символов",...o("password",{required:!0,minLength:3}),label:"Пароль",type:"password",variant:"outlined"}),a&&s.jsx("p",{style:{color:"red",textAlign:"center"},children:a}),s.jsx(f,{type:"submit",variant:"contained",children:"Войти"})]})},A="_login__title_1lfta_1",F="_login__hint_1lfta_5",N="_login__link_1lfta_9",g={login__title:A,login__hint:F,login__link:N},q=()=>s.jsxs("div",{className:g.login,children:[s.jsx("h1",{className:g.login__title,children:"Авторизация"}),s.jsx(I,{}),s.jsxs("p",{className:g.login__hint,children:["Еще не зарегистрированы?",s.jsx(w,{className:g.login__link,style:{color:"#ff9800"},to:u.register,children:"Регистрация"})]})]});export{q as default};
